# Task Specification: Proof Repair Eval Extraction (Lean 4)

## 1. Objective
Extract "Proof Repair" challenges from the `curve25519-dalek-lean-verify` repository history. A challenge is defined as a scenario where a change to a definition, structure, or lemma statement broke existing proofs, requiring a developer to update the proof scripts to restore the "QED" state.

## 2. Target Repository
- **URL:** `https://github.com/Beneficial-AI-Foundation/curve25519-dalek-lean-verify`
- **Language:** Lean 4
- **Build System:** Lake

## 3. Extraction Pipeline (The "Mining" Logic)

The agent should implement a script to automate the following steps:

### Phase A: Identification
1. **Iterate backwards** through the git log (starting from `master`).
2. **Filter Commits:** Look for commits that modify *both* a "specification/definition" file and a "proof" file.
    - *Definition files:* Files containing `inductive`, `structure`, `def`, or those generated by Aeneas.
    - *Proof files:* Files containing `theorem`, `lemma`, and significant `tactic` blocks.
3. **Isolate the "Break":**
    - Let **Commit C** be the "Fixed" state (current).
    - Let **Commit C~1** be the "Old" state (parent).
    - **Step:** Checkout Commit C, but overwrite the proof files with the versions from Commit C~1.
    - **Step:** Run `lake build`.
    - **Selection Criteria:** If `lake build` fails with a verification error, this is a valid **Proof Repair Task**.

### Phase B: Challenge Packaging
For every valid task found, generate a JSON object with the following schema:

```json
{
  "task_id": "commit_hash_file_name",
  "metadata": {
    "original_commit": "hash",
    "author_fix_diff": "git_diff_string",
    "error_message": "stderr_from_lake_build"
  },
  "setup": {
    "instructions": "The definitions in [File X] have changed. Update the proof in [File Y] to restore verification.",
    "codebase_state": "filesystem_snapshot_at_C_with_reverted_proofs"
  },
  "verification": {
    "command": "lake build [TargetFile]",
    "expected_output": "Success / Qed"
  }
}
```
