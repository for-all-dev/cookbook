# Specialized Insertion Tools

A key design decision in our plain Python agent is the use of specialized tools for inserting Dafny hints. Instead of a single, monolithic tool that takes the entire Dafny file as input, we have five specialized tools, each responsible for inserting a specific type of hint. ## TODO: audit the prose to make sure its not too LLMy

- `insert_invariant()`: For loop invariants.
- `insert_assertion()`: For intermediate assertions.
- `insert_precondition()`: For function `requires` clauses.
- `insert_postcondition()`: For function `ensures` clauses.
- `insert_measure()`: For `decreases` clauses for termination.

This design has several advantages. First, it makes the tools themselves simpler and more focused. Each tool has a single responsibility, which makes it easier to implement, test, and maintain.

Second, it makes the agent's job easier. Instead of having to generate the entire Dafny file every time it wants to make a change, the agent can simply specify the hint it wants to insert and where it wants to insert it. This reduces the cognitive load on the agent and makes it less likely to make mistakes.

Of course, this approach also has its trade-offs. It makes the tool API more complex, and it means the agent needs to be taught how to use the different tools. But for a task as complex as formal verification, we believe the benefits of specialized tools outweigh the costs.

Here's the implementation of the `insert_invariant` tool. The other insertion tools are very similar.

```{literalinclude} ../../evals/src/evals/dafnybench/plain/tools.py
:language: python
:caption: The insert_invariant tool
:start-at: "def insert_invariant"
:end-before: "def insert_assertion"
```

This design philosophy of small, focused, and composable tools is a recurring theme in agent development. It's a powerful way to manage complexity and build robust and reliable agents.