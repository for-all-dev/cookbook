# Dual Location Specification

Once we have specialized insertion tools, we need a way for the agent to specify *where* it wants to insert the hints. This is a surprisingly tricky problem. ## TODO: audit the prose to make sure its not too LLMy

One approach is to use line numbers. Line numbers are precise, but they're also brittle. If the code changes, the line numbers might become invalid.

Another approach is to use context matching. The agent can specify a few lines of code that appear before or after the insertion point. This is more flexible, but it can be ambiguous if the same context appears in multiple places.

Our plain Python agent uses a hybrid approach. The insertion tools accept both a `line_number` and a `context_before` argument. The agent can provide either one, or both.

```{literalinclude} ../../evals/src/evals/dafnybench/plain/tools.py
:language: python
:caption: The find_insertion_point function
:start-at: "def find_insertion_point"
:end-before: "def insert_invariant"
```

The `find_insertion_point` function first checks for a line number. If it's provided, it uses that. Otherwise, it uses the context to find the insertion point. If the context is ambiguous, it returns an error message to the agent.

This dual location specification makes the tools more robust and user-friendly for the agent. It's a great example of how to design tool APIs with the agent in mind.